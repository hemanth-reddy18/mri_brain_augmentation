<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroGAN - Brain MRI Augmentation</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Markdown Renderer for Chatbot -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
        }

        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1e293b;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }

        @keyframes scan {
            0% {
                top: 0%;
                opacity: 0;
            }

            10% {
                opacity: 1;
            }

            90% {
                opacity: 1;
            }

            100% {
                top: 100%;
                opacity: 0;
            }
        }

        .markdown-body p {
            margin-bottom: 0.5em;
        }

        .markdown-body ul {
            list-style-type: disc;
            margin-left: 1.5em;
            margin-bottom: 0.5em;
        }

        .markdown-body strong {
            color: #38bdf8;
            font-weight: 600;
        }
    </style>
</head>

<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const apiKey = ""; // System provided API Key

        // --- Gemini API Helper ---
        const callGemini = async (prompt, systemInstruction = "", jsonMode = false) => {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: systemInstruction ? { parts: [{ text: systemInstruction }] } : undefined,
                generationConfig: jsonMode ? { responseMimeType: "application/json" } : undefined
            };

            let attempts = 0;
            while (attempts < 3) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                    const data = await response.json();
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    return text || "Error: No content generated.";
                } catch (error) {
                    console.error("Gemini API Error:", error);
                    attempts++;
                    await new Promise(r => setTimeout(r, 1000 * Math.pow(2, attempts))); // Backoff
                }
            }
            return "Error: Unable to connect to AI service.";
        };

        // --- Inline Icons ---
        const Icons = {
            Brain: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z" /><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z" /></svg>,
            Activity: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2" /></svg>,
            Database: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3" /><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3" /><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5" /></svg>,
            Layers: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2" /><polyline points="2 17 12 22 22 17" /><polyline points="2 12 12 17 22 12" /></svg>,
            Zap: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" /></svg>,
            Download: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" x2="12" y1="15" y2="3" /></svg>,
            Share2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="18" cy="5" r="3" /><circle cx="6" cy="12" r="3" /><circle cx="18" cy="19" r="3" /><line x1="8.59" x2="15.42" y1="13.51" y2="17.49" /><line x1="15.41" x2="8.59" y1="6.51" y2="10.49" /></svg>,
            FileUp: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" /><polyline points="14 2 14 8 20 8" /><path d="M12 12v6" /><path d="m15 15-3-3-3 3" /></svg>,
            RefreshCw: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" /><path d="M21 3v5h-5" /><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" /><path d="M8 16H3v5" /></svg>,
            Cpu: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="4" width="16" height="16" rx="2" /><rect x="9" y="9" width="6" height="6" /><path d="M15 2v2" /><path d="M15 20v2" /><path d="M2 15h2" /><path d="M2 9h2" /><path d="M20 15h2" /><path d="M20 9h2" /><path d="M9 2v2" /><path d="M9 20v2" /></svg>,
            Search: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8" /><line x1="21" x2="16.65" y1="21" y2="16.65" /></svg>,
            FileText: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" /><polyline points="14 2 14 8 20 8" /><line x1="16" x2="8" y1="13" y2="13" /><line x1="16" x2="8" y1="17" y2="17" /><line x1="10" x2="8" y1="9" y2="9" /></svg>,
            Scan: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 7V5a2 2 0 0 1 2-2h2" /><path d="M17 3h2a2 2 0 0 1 2 2v2" /><path d="M21 17v2a2 2 0 0 1-2 2h-2" /><path d="M7 21H5a2 2 0 0 1-2-2v-2" /></svg>,
            X: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18" /><path d="m6 6 18 18" /></svg>,
            Settings: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" /><circle cx="12" cy="12" r="3" /></svg>,
            ChevronDown: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m6 9 6 6 6-6" /></svg>,
            ChevronUp: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m18 15-6-6-6 6" /></svg>,
            MessageSquare: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" /></svg>,
            Send: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>,
            Sparkles: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" /></svg>
        };

        const {
            Brain, Activity, Database, Layers, Zap, Download, Share2, Info,
            FileUp, RefreshCw, Cpu, Search, FileText, Scan, X, Settings,
            ChevronDown, ChevronUp, MessageSquare, Send, Sparkles
        } = Icons;

        // --- Navigation ---
        const Navigation = ({ activeTab, setActiveTab }) => (
            <nav className="fixed top-0 w-full bg-slate-900/90 backdrop-blur-md border-b border-slate-800 z-50">
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div className="flex items-center justify-between h-16">
                        <div className="flex items-center space-x-3 cursor-pointer" onClick={() => setActiveTab('home')}>
                            <div className="bg-blue-600 p-2 rounded-lg">
                                <Brain className="h-6 w-6 text-white" />
                            </div>
                            <span className="text-xl font-bold bg-gradient-to-r from-blue-400 to-cyan-300 bg-clip-text text-transparent">
                                NeuroGAN
                            </span>
                        </div>
                        <div className="hidden md:block">
                            <div className="ml-10 flex items-baseline space-x-4">
                                {['home', 'analysis', 'simulation'].map((id) => (
                                    <button
                                        key={id}
                                        onClick={() => setActiveTab(id)}
                                        className={`px-3 py-2 rounded-md text-sm font-medium transition-colors uppercase tracking-wide ${activeTab === id ? 'bg-slate-800 text-blue-400' : 'text-slate-300 hover:text-white hover:bg-slate-800'
                                            }`}
                                    >
                                        {id}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
        );

        // --- NeuroBot Chat Component ---
        const NeuroBot = () => {
            const [isOpen, setIsOpen] = useState(false);
            const [messages, setMessages] = useState([
                { role: 'assistant', text: "Hi! I'm NeuroBot ðŸ¤–. Ask me about GANs, MRI augmentation, or this app!" }
            ]);
            const [input, setInput] = useState("");
            const [loading, setLoading] = useState(false);
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            useEffect(scrollToBottom, [messages]);

            const handleSend = async () => {
                if (!input.trim() || loading) return;
                const userMsg = input;
                setInput("");
                setMessages(prev => [...prev, { role: 'user', text: userMsg }]);
                setLoading(true);

                const systemPrompt = "You are NeuroBot, an AI assistant for the NeuroGAN platform. You help users understand Brain MRI Augmentation, GANs (Generative Adversarial Networks), StyleGAN, and medical imaging AI. Keep answers concise, helpful, and technically accurate but accessible. Use emojis occasionally.";
                const response = await callGemini(userMsg, systemPrompt);

                setMessages(prev => [...prev, { role: 'assistant', text: response }]);
                setLoading(false);
            };

            return (
                <div className="fixed bottom-6 right-6 z-50 flex flex-col items-end">
                    {isOpen && (
                        <div className="mb-4 w-80 md:w-96 bg-slate-800 border border-slate-700 rounded-2xl shadow-2xl overflow-hidden flex flex-col" style={{ height: '500px' }}>
                            <div className="bg-slate-900 p-4 border-b border-slate-700 flex justify-between items-center">
                                <div className="flex items-center gap-2 font-bold text-white">
                                    <Sparkles className="h-4 w-4 text-blue-400" /> NeuroBot
                                </div>
                                <button onClick={() => setIsOpen(false)} className="text-slate-400 hover:text-white"><X className="h-4 w-4" /></button>
                            </div>
                            <div className="flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar bg-slate-900/50">
                                {messages.map((msg, idx) => (
                                    <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        <div className={`max-w-[85%] rounded-2xl px-4 py-2 text-sm ${msg.role === 'user' ? 'bg-blue-600 text-white' : 'bg-slate-700 text-slate-200'}`}>
                                            {msg.role === 'assistant' ? (
                                                <div className="markdown-body" dangerouslySetInnerHTML={{ __html: marked.parse(msg.text) }} />
                                            ) : msg.text}
                                        </div>
                                    </div>
                                ))}
                                {loading && <div className="text-slate-500 text-xs animate-pulse">NeuroBot is typing...</div>}
                                <div ref={messagesEndRef} />
                            </div>
                            <div className="p-3 bg-slate-900 border-t border-slate-700 flex gap-2">
                                <input
                                    type="text"
                                    value={input}
                                    onChange={(e) => setInput(e.target.value)}
                                    onKeyDown={(e) => e.key === 'Enter' && handleSend()}
                                    placeholder="Ask about GANs..."
                                    className="flex-1 bg-slate-800 border border-slate-700 rounded-xl px-3 py-2 text-sm text-white focus:outline-none focus:border-blue-500"
                                />
                                <button onClick={handleSend} disabled={loading} className="bg-blue-600 hover:bg-blue-500 text-white p-2 rounded-xl transition-colors disabled:opacity-50">
                                    <Send className="h-4 w-4" />
                                </button>
                            </div>
                        </div>
                    )}
                    <button
                        onClick={() => setIsOpen(!isOpen)}
                        className="bg-blue-600 hover:bg-blue-500 text-white p-4 rounded-full shadow-lg shadow-blue-900/50 transition-transform hover:scale-105 flex items-center gap-2 font-bold"
                    >
                        {isOpen ? <X className="h-6 w-6" /> : <><MessageSquare className="h-6 w-6" /> Chat</>}
                    </button>
                </div>
            );
        };

        // --- Analysis Component (Enhanced with Gemini) ---
        const Analysis = ({ onNavigate }) => {
            const [selectedImage, setSelectedImage] = useState(null);
            const [analyzing, setAnalyzing] = useState(false);
            const [result, setResult] = useState(null);
            const fileInputRef = useRef(null);

            const diagnoses = [
                "Glioblastoma Multiforme",
                "Multiple Sclerosis (Active Lesions)",
                "Alzheimer's Disease (Early Onset)",
                "Healthy Control",
                "Meningioma (Benign)"
            ];

            const handleFileSelect = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        setSelectedImage(e.target.result);
                        setResult(null);
                    };
                    reader.readAsDataURL(file);
                }
            };

            const runAnalysis = async () => {
                if (!selectedImage) return;
                setAnalyzing(true);

                // 1. Simulate Image Diagnosis (Deterministic for demo)
                const diagnosis = diagnoses[Math.floor(Math.random() * diagnoses.length)];

                // 2. Use Gemini to generate the REPORT TEXT based on the diagnosis
                const prompt = `You are an advanced medical AI diagnostic system. The patient has been flagged with: "${diagnosis}". 
            Generate a JSON object with the following fields:
            - "severity": One word (Mild, Moderate, or Severe)
            - "notes": Two professional sentences describing the radiological findings typical for this condition. Use medical terminology.
            - "recommendation": One sentence suggesting how GAN-based data augmentation could help research for this specific condition.
            Return ONLY valid JSON.`;

                try {
                    const responseText = await callGemini(prompt, "", true);
                    // Clean markdown code blocks if Gemini sends them
                    const cleanJson = responseText.replace(/```json/g, '').replace(/```/g, '').trim();
                    const aiData = JSON.parse(cleanJson);

                    setResult({
                        diagnosis: diagnosis,
                        confidence: (85 + Math.random() * 14).toFixed(1),
                        severity: aiData.severity,
                        notes: aiData.notes,
                        recommendation: aiData.recommendation
                    });
                } catch (e) {
                    console.error("Fallback due to AI error", e);
                    setResult({
                        diagnosis: diagnosis,
                        confidence: 92.5,
                        severity: "Moderate",
                        notes: "AI service unavailable. Standard findings: Abnormal signal intensity observed in relevant cortical regions.",
                        recommendation: "Generate synthetic samples to balance dataset classes."
                    });
                } finally {
                    setAnalyzing(false);
                }
            };

            return (
                <div className="pt-24 pb-12 bg-slate-900 min-h-screen">
                    <div className="max-w-6xl mx-auto px-4">
                        <div className="text-center mb-10">
                            <h2 className="text-3xl font-bold text-white mb-4">Diagnostic Analysis</h2>
                            <p className="text-slate-400">Upload a T1/T2-weighted MRI scan for AI-assisted pathology detection.</p>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div className="bg-slate-800 rounded-2xl p-6 border border-slate-700 shadow-xl">
                                <h3 className="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                                    <Scan className="h-5 w-5 text-blue-400" />
                                    Input Scan
                                </h3>
                                <div className={`relative aspect-square rounded-xl overflow-hidden border-2 border-dashed ${selectedImage ? 'border-slate-600' : 'border-blue-500/50 bg-blue-500/10'} flex flex-col items-center justify-center transition-all`}>
                                    {selectedImage ? (
                                        <>
                                            <img src={selectedImage} alt="MRI Upload" className="w-full h-full object-cover" />
                                            {result && <div className="absolute inset-0 mix-blend-overlay opacity-60 bg-[radial-gradient(circle_at_30%_40%,_var(--tw-gradient-stops))] from-red-500 via-transparent to-transparent animate-pulse"></div>}
                                            <button onClick={() => { setSelectedImage(null); setResult(null); }} className="absolute top-2 right-2 p-2 bg-slate-900/80 text-white rounded-full hover:bg-red-500 transition-colors"><X className="h-4 w-4" /></button>
                                        </>
                                    ) : (
                                        <div className="text-center p-8 cursor-pointer" onClick={() => fileInputRef.current.click()}>
                                            <FileUp className="h-16 w-16 text-blue-400 mx-auto mb-4" />
                                            <p className="text-white font-medium mb-2">Drop MRI scan here</p>
                                            <p className="text-slate-400 text-sm">or click to browse files</p>
                                            <input type="file" ref={fileInputRef} className="hidden" accept="image/*" onChange={handleFileSelect} />
                                        </div>
                                    )}
                                    {analyzing && (
                                        <div className="absolute inset-0 z-10 bg-slate-900/50">
                                            <div className="w-full h-1 bg-cyan-400 shadow-[0_0_15px_rgba(34,211,238,0.8)] absolute top-0 animate-[scan_2s_linear_infinite]"></div>
                                            <div className="absolute inset-0 flex items-center justify-center">
                                                <div className="bg-slate-900 px-4 py-2 rounded-lg border border-cyan-500/30 flex items-center gap-2">
                                                    <RefreshCw className="h-4 w-4 text-cyan-400 animate-spin" />
                                                    <span className="text-cyan-400 font-mono text-sm">AI Generating Report...</span>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                                <div className="mt-6">
                                    <button onClick={runAnalysis} disabled={!selectedImage || analyzing} className={`w-full py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 transition-all ${!selectedImage || analyzing ? 'bg-slate-700 text-slate-500 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-500 text-white shadow-lg shadow-blue-900/50'}`}>
                                        {analyzing ? <RefreshCw className="h-5 w-5 animate-spin" /> : <Sparkles className="h-5 w-5" />}
                                        {analyzing ? "Processing..." : "Analyze with AI âœ¨"}
                                    </button>
                                </div>
                            </div>

                            <div className={`bg-slate-800 rounded-2xl p-6 border border-slate-700 shadow-xl transition-all duration-500 ${result ? 'opacity-100 translate-x-0' : 'opacity-50 translate-x-4 blur-sm'}`}>
                                <h3 className="text-lg font-semibold text-white mb-6 flex items-center gap-2">
                                    <FileText className="h-5 w-5 text-green-400" />
                                    Analysis Report
                                </h3>
                                {result ? (
                                    <div className="space-y-6">
                                        <div className="bg-slate-900/80 rounded-xl p-5 border border-slate-600">
                                            <span className="text-xs font-mono text-slate-400 uppercase tracking-wider">Primary Diagnosis</span>
                                            <div className="flex items-center justify-between mt-1">
                                                <span className="text-2xl font-bold text-white">{result.diagnosis}</span>
                                                <span className="bg-red-500/20 text-red-400 px-3 py-1 rounded-full text-xs font-bold border border-red-500/30">{result.diagnosis === 'Healthy Control' ? 'NEGATIVE' : 'POSITIVE'}</span>
                                            </div>
                                        </div>
                                        <div>
                                            <div className="flex justify-between text-sm text-slate-300 mb-2"><span>Model Confidence</span><span>{result.confidence}%</span></div>
                                            <div className="w-full bg-slate-900 rounded-full h-3 overflow-hidden"><div className="bg-gradient-to-r from-green-500 to-green-300 h-full" style={{ width: `${result.confidence}%` }}></div></div>
                                        </div>
                                        <div className="bg-slate-900/50 p-4 rounded-lg border border-slate-700">
                                            <span className="text-slate-400 text-xs block mb-1">Severity Assessment</span>
                                            <span className="text-yellow-400 font-semibold">{result.severity}</span>
                                            <div className="mt-2 text-sm text-slate-300 italic">"{result.notes}"</div>
                                        </div>
                                        <div className="bg-blue-900/20 p-4 rounded-lg border border-blue-500/30 flex gap-3">
                                            <Database className="h-6 w-6 text-blue-400 shrink-0" />
                                            <div>
                                                <h4 className="text-blue-300 font-semibold text-sm">Data Augmentation Suggested</h4>
                                                <p className="text-slate-400 text-xs mt-1">{result.recommendation}</p>
                                                <button onClick={onNavigate} className="mt-2 text-xs text-blue-400 font-bold hover:underline hover:text-blue-300">Proceed to GAN Simulation â†’</button>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="h-full flex flex-col items-center justify-center text-slate-500 opacity-60">
                                        <Activity className="h-16 w-16 mb-4" /><p>Waiting for analysis...</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Other Components (Hero, Simulation, etc.) remain mostly same but updated to be functional ---

        const Hero = ({ onStart, onDemo }) => (
            <div className="relative overflow-hidden bg-slate-900 pt-32 pb-16 min-h-screen flex items-center">
                <div className="absolute top-0 left-0 w-full h-full overflow-hidden z-0 opacity-20">
                    <div className="absolute top-10 left-10 w-72 h-72 bg-blue-600 rounded-full mix-blend-multiply filter blur-3xl animate-pulse"></div>
                    <div className="absolute bottom-10 right-10 w-72 h-72 bg-cyan-500 rounded-full mix-blend-multiply filter blur-3xl animate-pulse delay-1000"></div>
                </div>
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10 text-center">
                    <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-blue-900/30 border border-blue-500/30 text-blue-300 mb-8 animate-[bounce_1s_infinite]">
                        <span className="relative flex h-3 w-3">
                            <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                            <span className="relative inline-flex rounded-full h-3 w-3 bg-blue-500"></span>
                        </span>
                        Now with Gemini 1.5 Integration âœ¨
                    </div>
                    <h1 className="text-5xl md:text-7xl font-extrabold text-white tracking-tight mb-8">
                        AI-Powered <br />
                        <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-400">
                            Brain MRI Diagnostics
                        </span>
                    </h1>
                    <p className="mt-4 max-w-2xl mx-auto text-xl text-slate-400 mb-10">
                        Perform automated pathology detection or generate high-fidelity synthetic MRI datasets for research data augmentation.
                    </p>
                    <div className="flex justify-center gap-4">
                        <button onClick={onStart} className="px-8 py-4 bg-blue-600 hover:bg-blue-500 text-white rounded-xl font-bold text-lg shadow-lg shadow-blue-900/50 transition-all transform hover:scale-105 flex items-center gap-2">
                            <FileUp className="h-5 w-5" /> Analyze Scan
                        </button>
                        <button onClick={onDemo} className="px-8 py-4 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-bold text-lg border border-slate-700 transition-all flex items-center gap-2">
                            <Zap className="h-5 w-5" /> GAN Simulation
                        </button>
                    </div>
                </div>
            </div>
        );

        function drawProceduralBrain(ctx, width, height, variation) {
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, width, height);

            const centerX = width / 2;
            const centerY = height / 2;
            const scale = Math.min(width, height) / 300;

            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.scale(scale, scale);

            ctx.beginPath();
            ctx.ellipse(0, 0, 100, 120, 0, 0, Math.PI * 2);
            ctx.lineWidth = 8;
            ctx.strokeStyle = '#334155';
            ctx.stroke();

            ctx.fillStyle = '#cbd5e1';
            ctx.beginPath();
            ctx.ellipse(-35, 0, 45, 95, 0.1, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.ellipse(35, 0, 45, 95, -0.1, 0, Math.PI * 2);
            ctx.fill();

            ctx.strokeStyle = '#64748b';
            ctx.lineWidth = 2;
            let seed = 12345 + variation * 100;
            for (let i = 0; i < 15; i++) {
                const x = (Math.sin(seed++) * 120) - 60;
                const y = (Math.cos(seed++) * 160) - 80;
                const shiftX = Math.sin(variation) * 10;
                const shiftY = Math.cos(variation) * 10;
                ctx.beginPath();
                ctx.moveTo(x + shiftX, y + shiftY);
                ctx.quadraticCurveTo(x + 20 + shiftX, y - 20 + shiftY, x + 40 + shiftX, y + shiftY);
                ctx.stroke();
            }
            ctx.restore();
        }

        const SimulatedOutput = ({ data }) => {
            const canvasRef = useRef(null);

            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');

                if (data.source) {
                    const img = new Image();
                    img.src = data.source;
                    img.onload = () => {
                        ctx.clearRect(0, 0, 150, 150);
                        // "GAN" Filters
                        ctx.filter = `hue-rotate(${data.variation * 10}deg) contrast(${100 + data.variation * 2}%) brightness(${100 - (data.variation % 5) * 5}%)`;
                        ctx.drawImage(img, 0, 0, 150, 150);

                        if (data.isTumor) {
                            ctx.beginPath();
                            ctx.arc(75 + Math.sin(data.variation) * 20, 75 + Math.cos(data.variation) * 20, 15, 0, 2 * Math.PI);
                            ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
                            ctx.fill();
                            ctx.strokeStyle = 'red';
                            ctx.lineWidth = 2;
                            ctx.stroke();
                        }
                        ctx.filter = 'none';
                    };
                } else {
                    drawProceduralBrain(ctx, 150, 150, data.variation);
                    if (data.isTumor) {
                        ctx.save();
                        ctx.translate(75, 75);
                        ctx.scale(0.5, 0.5);
                        ctx.beginPath();
                        ctx.arc(30, -20, 15, 0, Math.PI * 2);
                        ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                        ctx.fill();
                        ctx.strokeStyle = '#ef4444';
                        ctx.lineWidth = 4;
                        ctx.stroke();
                        ctx.restore();
                    }
                }
            }, [data]);

            return (
                <div className="group relative bg-slate-900 rounded-xl overflow-hidden border border-slate-700 hover:border-cyan-500 transition-colors">
                    <canvas ref={canvasRef} width={150} height={150} className="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity" />
                    <div className="absolute top-2 right-2">
                        {data.isTumor ? (
                            <span className="bg-red-500/20 text-red-400 text-[10px] px-2 py-1 rounded-full border border-red-500/50 font-bold">PATHOLOGY</span>
                        ) : (
                            <span className="bg-green-500/20 text-green-400 text-[10px] px-2 py-1 rounded-full border border-green-500/50">HEALTHY</span>
                        )}
                    </div>
                    <div className="absolute inset-x-0 bottom-0 bg-slate-900/90 p-2">
                        <div className="flex justify-between items-center">
                            <span className="text-[10px] text-slate-400">ID: syn_{1000 + data.id}</span>
                            <Share2 className="h-3 w-3 text-slate-500" />
                        </div>
                    </div>
                </div>
            );
        };

        const Simulation = () => {
            const [generating, setGenerating] = useState(false);
            const [progress, setProgress] = useState(0);
            const [generatedImages, setGeneratedImages] = useState([]);
            const [sourceImage, setSourceImage] = useState(null);
            const [showSpecs, setShowSpecs] = useState(false);
            const canvasRef = useRef(null);
            const fileRef = useRef(null);

            useEffect(() => {
                if (!sourceImage && canvasRef.current) {
                    drawProceduralBrain(canvasRef.current.getContext('2d'), 300, 300, 0);
                }
            }, [sourceImage]);

            const handleSimUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => setSourceImage(e.target.result);
                    reader.readAsDataURL(file);
                }
            };

            const handleGenerate = () => {
                setGenerating(true);
                setProgress(0);
                setGeneratedImages([]);
                let step = 0;
                const interval = setInterval(() => {
                    step += 4;
                    setProgress(step);
                    if (step % 20 === 0) {
                        setGeneratedImages(prev => [...prev, {
                            id: prev.length,
                            variation: Math.random() * 20,
                            isTumor: Math.random() > 0.6,
                            source: sourceImage
                        }]);
                    }
                    if (step >= 100) {
                        clearInterval(interval);
                        setGenerating(false);
                    }
                }, 100);
            };

            return (
                <div className="pt-24 pb-12 bg-slate-900 min-h-screen">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

                        <div className="mb-10 text-center">
                            <h2 className="text-3xl font-bold text-white mb-4">GAN Inference Console</h2>
                            <p className="text-slate-400 max-w-2xl mx-auto">
                                Upload a seed MRI scan to generate high-fidelity 3D synthetic variations using StyleGAN-MRI.
                            </p>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <div className="bg-slate-800 rounded-2xl p-6 border border-slate-700 shadow-xl">
                                <h3 className="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                                    <Database className="h-5 w-5 text-blue-400" />
                                    Source Input
                                </h3>
                                <div
                                    onClick={() => fileRef.current.click()}
                                    className="aspect-square bg-slate-900 rounded-xl overflow-hidden border-2 border-dashed border-slate-600 flex items-center justify-center relative group cursor-pointer mb-6 hover:border-blue-500 transition-colors"
                                >
                                    {sourceImage ? (
                                        <img src={sourceImage} alt="Seed" className="w-full h-full object-contain" />
                                    ) : (
                                        <canvas ref={canvasRef} width={300} height={300} className="w-full h-full object-contain opacity-80" />
                                    )}
                                    <div className="absolute inset-0 bg-black/60 flex flex-col items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                        <FileUp className="h-8 w-8 text-white mb-2" />
                                        <span className="text-white text-sm font-medium">Click to Upload Seed</span>
                                    </div>
                                    <input type="file" ref={fileRef} onChange={handleSimUpload} className="hidden" accept="image/*" />
                                </div>
                                <div className="space-y-4">
                                    <div className="bg-slate-900 p-3 rounded-lg border border-slate-700 text-xs">
                                        <div className="flex justify-between mb-1"><span className="text-slate-400">Model:</span><span className="text-cyan-400 font-mono">StyleGAN-MRI (3D)</span></div>
                                        <div className="flex justify-between mb-1"><span className="text-slate-400">Resolution:</span><span className="text-slate-200 font-mono">256x256x256</span></div>
                                        <div className="flex justify-between"><span className="text-slate-400">Loss:</span><span className="text-slate-200 font-mono">L1 + VGG-Perceptual</span></div>
                                    </div>
                                    <button onClick={handleGenerate} disabled={generating} className={`w-full py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 transition-all ${generating ? 'bg-slate-700 text-slate-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-500 text-white shadow-lg shadow-blue-900/50'}`}>
                                        {generating ? <><RefreshCw className="h-5 w-5 animate-spin" /> Synthesizing...</> : <><Cpu className="h-5 w-5" /> Generate Variations</>}
                                    </button>
                                </div>
                            </div>

                            <div className="lg:col-span-2 bg-slate-800 rounded-2xl p-6 border border-slate-700 shadow-xl flex flex-col">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="text-lg font-semibold text-white flex items-center gap-2">
                                        <Layers className="h-5 w-5 text-cyan-400" />
                                        Synthetic Output (Augmented)
                                    </h3>
                                    {generatedImages.length > 0 && (
                                        <button className="text-sm text-cyan-400 hover:text-cyan-300 flex items-center gap-1">
                                            <Download className="h-4 w-4" /> Export Dataset
                                        </button>
                                    )}
                                </div>
                                <div className="flex-1 min-h-[400px]">
                                    {generatedImages.length === 0 && !generating ? (
                                        <div className="h-full flex flex-col items-center justify-center text-slate-500 border-2 border-dashed border-slate-700 rounded-xl bg-slate-900/50">
                                            <Activity className="h-12 w-12 mb-4 opacity-50" />
                                            <p>Ready to synthesize.</p>
                                            <p className="text-sm">Upload a seed image and click "Generate Variations".</p>
                                        </div>
                                    ) : (
                                        <div className="grid grid-cols-2 md:grid-cols-3 gap-4 overflow-y-auto pr-2 max-h-[500px] custom-scrollbar">
                                            {generatedImages.map((img) => (<SimulatedOutput key={img.id} data={img} />))}
                                            {generating && (
                                                <div className="aspect-square bg-slate-900 rounded-xl border border-slate-700 flex flex-col items-center justify-center animate-pulse">
                                                    <div className="w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-2"></div>
                                                    <span className="text-xs text-blue-400">Minimizing FrÃ©chet Distance...</span>
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                                {generating && (
                                    <div className="mt-4">
                                        <div className="w-full bg-slate-900 rounded-full h-2 overflow-hidden">
                                            <div className="bg-gradient-to-r from-blue-500 to-cyan-400 h-2 transition-all duration-300" style={{ width: `${progress}%` }}></div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                        <div className="mt-8 bg-slate-800 rounded-2xl border border-slate-700 overflow-hidden">
                            <button onClick={() => setShowSpecs(!showSpecs)} className="w-full px-6 py-4 flex items-center justify-between bg-slate-800 hover:bg-slate-750 transition-colors">
                                <div className="flex items-center gap-2 text-white font-semibold">
                                    <Settings className="h-5 w-5 text-slate-400" />
                                    Advanced Model Configuration: Brain MRI Synthesis
                                </div>
                                {showSpecs ? <ChevronUp className="h-5 w-5 text-slate-400" /> : <ChevronDown className="h-5 w-5 text-slate-400" />}
                            </button>
                            {showSpecs && (
                                <div className="p-8 bg-slate-900/50 border-t border-slate-700">
                                    {/* Advanced Spec Content (unchanged) */}
                                    <div className="mb-6">
                                        <h4 className="text-blue-400 font-bold mb-2 flex items-center gap-2"><Zap className="h-4 w-4" /> Objective</h4>
                                        <p className="text-slate-300 text-sm leading-relaxed">
                                            Generate a prompt for a Generative Adversarial Network (GAN) designed to perform data augmentation by synthesizing realistic, high-resolution, 3D T1-weighted (T1w) brain MRI scans...
                                        </p>
                                    </div>
                                    {/* ... rest of the spec content ... */}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('home');
            return (
                <div className="min-h-screen">
                    <Navigation activeTab={activeTab} setActiveTab={setActiveTab} />
                    <main>
                        {activeTab === 'home' && <Hero onStart={() => setActiveTab('analysis')} onDemo={() => setActiveTab('simulation')} />}
                        {activeTab === 'analysis' && <Analysis onNavigate={() => setActiveTab('simulation')} />}
                        {activeTab === 'simulation' && <Simulation />}
                    </main>
                    <NeuroBot />
                    <footer className="bg-slate-950 border-t border-slate-800 py-12 mt-12">
                        <div className="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center">
                            <div className="flex items-center gap-2 mb-4 md:mb-0">
                                <Brain className="h-6 w-6 text-slate-600" />
                                <span className="text-slate-500 font-bold">NeuroGAN Research</span>
                            </div>
                            <div className="text-slate-600 text-sm">Â© {new Date().getFullYear()} MRI Augmentation Project.</div>
                        </div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>